# Feature Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ENTERPRISE ELYSIUM CRM                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Affectations Page                         â”‚  â”‚
â”‚  â”‚  (src/pages/Index.tsx - tab: 'assignments')                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚         â”‚                                 â”‚                        â”‚
â”‚         â–¼                                 â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ AssignmentManager   â”‚      â”‚ Authorization Check            â”‚  â”‚
â”‚  â”‚                     â”‚      â”‚ currentUserRole === ADMIN ||   â”‚  â”‚
â”‚  â”‚ Existing Features   â”‚      â”‚ MANAGER                        â”‚  â”‚
â”‚  â”‚ âœ“ Individual add    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ âœ“ View assignments  â”‚                      â”‚                   â”‚
â”‚  â”‚ âœ“ Remove assign     â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ âœ“ Company detail    â”‚              â”‚ True          â”‚           â”‚
â”‚  â”‚                     â”‚              â”‚ Render        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ Component     â”‚           â”‚
â”‚                                        â–¼               â–¼           â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                              â”‚ BulkRandomAssignment Component â”‚    â”‚
â”‚                              â”‚ ğŸ†• NEW FEATURE                 â”‚    â”‚
â”‚                              â”‚                                â”‚    â”‚
â”‚                              â”‚ âœ“ Fetch users & companies      â”‚    â”‚
â”‚                              â”‚ âœ“ Show statistics              â”‚    â”‚
â”‚                              â”‚ âœ“ Multi-select users           â”‚    â”‚
â”‚                              â”‚ âœ“ Configure per-user count     â”‚    â”‚
â”‚                              â”‚ âœ“ Validate & confirm           â”‚    â”‚
â”‚                              â”‚ âœ“ Bulk create assignments      â”‚    â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â–¼â–¼â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SUPABASE DATABASE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   PROFILES   â”‚    â”‚  COMPANIES   â”‚    â”‚ ASSIGNMENTS  â”‚         â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚         â”‚
â”‚  â”‚ id           â”‚    â”‚ id           â”‚    â”‚ id           â”‚         â”‚
â”‚  â”‚ user_id      â”‚    â”‚ name         â”‚    â”‚ company_id â”€â”€â”¼â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ name         â”‚    â”‚ contact_name â”‚    â”‚ user_id â”€â”€â”€â”€â”€â”¼â”€â”€â”  â”‚  â”‚
â”‚  â”‚ role         â”‚    â”‚ status       â”‚    â”‚ role         â”‚  â”‚  â”‚  â”‚
â”‚  â”‚ created_at   â”‚    â”‚ created_at   â”‚    â”‚ created_at   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚  â”‚  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚       â–²                     â–²                     â–²          â”‚  â”‚  â”‚
â”‚       â”‚ (read)              â”‚ (read)              â”‚          â”‚  â”‚  â”‚
â”‚       â”‚                     â”‚                     â””â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”˜  â”‚
â”‚                  (read list)              (read list)   â”‚    â”‚     â”‚
â”‚                                              (insert)   â”‚    â”‚     â”‚
â”‚                                                         â”‚    â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”   â”‚     â”‚
â”‚  â”‚        Bulk Assignment Query Process                â”‚   â”‚     â”‚
â”‚  â”‚                                                      â”‚   â”‚     â”‚
â”‚  â”‚ 1. SELECT * FROM profiles                           â”‚   â”‚     â”‚
â”‚  â”‚ 2. SELECT * FROM companies                          â”‚   â”‚     â”‚
â”‚  â”‚ 3. SELECT company_id FROM assignments               â”‚   â”‚     â”‚
â”‚  â”‚ 4. FILTER companies WHERE id NOT IN (assigned)      â”‚   â”‚     â”‚
â”‚  â”‚ 5. [SHUFFLE COMPANIES IN-APP]                       â”‚   â”‚     â”‚
â”‚  â”‚ 6. INSERT INTO assignments (bulk)                   â”‚â—„â”€â”€â”˜     â”‚
â”‚  â”‚                                                      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Interaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User visits Affectations page      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check user role                    â”‚
â”‚  (from AuthContext)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
       â”‚             â”‚
   Admin/Manager  Volunteer
       â”‚             â”‚
       â–¼             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SHOW     â”‚  â”‚ HIDE     â”‚
   â”‚FEATURE   â”‚  â”‚ FEATURE  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BulkRandomAssignment mounted       â”‚
â”‚  useEffect triggers                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  fetchData() called                 â”‚
â”‚  - Load all users                   â”‚
â”‚  - Load all companies               â”‚
â”‚  - Find unassigned companies        â”‚
â”‚  - Calculate statistics             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Render UI with stats               â”‚
â”‚  - User checkboxes                  â”‚
â”‚  - Input field                      â”‚
â”‚  - Summary warnings                 â”‚
â”‚  - Create button (disabled/enabled) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User interacts with form           â”‚
â”‚  - Selects users                    â”‚
â”‚  - Sets companies/user              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validation in real-time            â”‚
â”‚  - Check user count > 0             â”‚
â”‚  - Check companies available        â”‚
â”‚  - Check total â‰¤ available          â”‚
â”‚  - Update button state              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
       â”‚             â”‚
    Invalid        Valid
       â”‚             â”‚
       â–¼             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ DISABLED â”‚  â”‚ ENABLED  â”‚
   â”‚ Button   â”‚  â”‚ Button   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ User clicks btn  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Confirmation Dialog Show  â”‚
         â”‚ Summary displayed        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                â”‚
       Cancel           Confirm
          â”‚                â”‚
          â–¼                â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Dialog  â”‚    â”‚ Execute      â”‚
     â”‚ Closes  â”‚    â”‚ Bulk Assign  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ performBulkAssign() â”‚
                   â”‚ - Shuffle companies â”‚
                   â”‚ - Create array      â”‚
                   â”‚ - Insert to DB      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚
                 Success          Error
                    â”‚                â”‚
                    â–¼                â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Success Toastâ”‚  â”‚ Error    â”‚
              â”‚ Refresh data â”‚  â”‚ Toast    â”‚
              â”‚ Reset form   â”‚  â”‚ No reset â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Distribution Algorithm

```
SCENARIO: 3 users, 12 unassigned companies, 4 per user

Step 1: Collect unassigned companies
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Companies in DB (unassigned only):  â”‚
â”‚ 1. Acme Corp                       â”‚
â”‚ 2. TechCorp                        â”‚
â”‚ 3. StartupXYZ                      â”‚
â”‚ 4. WebServices Inc                 â”‚
â”‚ 5. CloudSys                        â”‚
â”‚ 6. DataFlow                        â”‚
â”‚ 7. InfoNet                         â”‚
â”‚ 8. NetConnect                      â”‚
â”‚ 9. FastNet                         â”‚
â”‚ 10. SecureIT                       â”‚
â”‚ 11. AppStudio                      â”‚
â”‚ 12. CodeFactory                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: Shuffle randomly
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ After shuffle (random order):       â”‚
â”‚ [7, 2, 11, 5, 1, 9, 3, 12, 4, 8,  â”‚
â”‚  6, 10]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: Distribute fairly in round-robin
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User A: [7, 5, 3, 6]               â”‚
â”‚ User B: [2, 1, 12, 10]             â”‚
â”‚ User C: [11, 9, 4, 8]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: Create assignment objects
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Assignments to insert:             â”‚
â”‚ {company: 7, user: A, role: 'C'}   â”‚
â”‚ {company: 2, user: B, role: 'C'}   â”‚
â”‚ {company: 11, user: C, role: 'C'}  â”‚
â”‚ {company: 5, user: A, role: 'C'}   â”‚
â”‚ {company: 1, user: B, role: 'C'}   â”‚
â”‚ ... (12 total)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: Each user has 4 random companies
âœ“ Fair distribution
âœ“ Random allocation
âœ“ No duplicates
```

---

## Component State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    COMPONENT    â”‚
                    â”‚    MOUNTED      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  LOADING STATE  â”‚
                    â”‚ isLoading=true  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ (data loaded)
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  IDLE STATE     â”‚
                    â”‚ Ready for input â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                      â”‚             â”‚
                   Input          Valid?
                   Changed        Check
                      â”‚             â”‚
                      â–¼             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ VALIDATING STATE â”‚
                    â”‚ Real-time check  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                      â”‚             â”‚
                   Invalid       Valid
                      â”‚             â”‚
                      â–¼             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ INVALID     â”‚  â”‚ VALID    â”‚
              â”‚ Button OFF  â”‚  â”‚ Button ONâ”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                      â–²              â”‚
                      â”‚              â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (input changes)
                             â”‚
                        User clicks
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ CONFIRMING      â”‚
                    â”‚ Dialog shown    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                      â”‚             â”‚
                   Cancel        Confirm
                      â”‚             â”‚
                      â–¼             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ IDLE     â”‚  â”‚ PROCESSING STATE  â”‚
                    â”‚ Resume   â”‚  â”‚ isProcessing=true â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ Button disabled   â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                                     â”‚             â”‚
                                  Success       Error
                                     â”‚             â”‚
                                     â–¼             â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ SUCCESS STATE â”‚  â”‚ ERROR    â”‚
                              â”‚ Toast shown   â”‚  â”‚ Toast    â”‚
                              â”‚ Data refresh  â”‚  â”‚ No reset â”‚
                              â”‚ Form reset    â”‚  â”‚ Stay     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                      â”‚              â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   IDLE STATE    â”‚
                                    â”‚  Ready again    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Permission & Access Control

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     User Authentication                      â”‚
â”‚                      (Supabase Auth)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Read Profile/Role from   â”‚
        â”‚   AuthContext              â”‚
        â”‚   currentUserRole          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚       â”‚        â”‚
      ADMIN   MANAGER   VOLUNTEER
          â”‚       â”‚        â”‚
          â–¼       â–¼        â–¼
       â”Œâ”€â”€â”    â”Œâ”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”
       â”‚âœ“ â”‚    â”‚âœ“ â”‚    â”‚  âœ—   â”‚
       â””â”€â”€â”˜    â””â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜
       ACCESS  ACCESS  NO ACCESS
         â”‚       â”‚        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚
                                    â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Conditional Render  â”‚
                         â”‚ {condition &&       â”‚
                         â”‚  <Component />}     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                    â”‚
                      SHOW            DONT SHOW
                         â”‚                    â”‚
                         â–¼                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ FEATURE â”‚      â”‚ Empty / null   â”‚
                    â”‚ VISIBLE â”‚      â”‚ Not rendered   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Transaction Flow

```
â”Œâ”€ BulkRandomAssignment Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  1. User clicks "Create Assignments"                        â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚  2. performBulkAssignment() called                          â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚  3. Validate: users.length > 0, available > needed âœ“        â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚  4. Shuffle array                                           â”‚
â”‚     const shuffled = [...unassignedCompanies]               â”‚
â”‚                    .sort(() => Math.random() - 0.5)         â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚  5. Create assignments array                                â”‚
â”‚     Loop: for each company slot                             â”‚
â”‚            for each selected user                           â”‚
â”‚            push { company_id, user_id, role }               â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚  6. setIsProcessing(true) â† Disable UI                      â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€ Supabase Client â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                           â”‚
â”‚  supabase                                                â”‚
â”‚    .from('assignments')                                 â”‚
â”‚    .insert(assignmentsArray)                            â”‚
â”‚                                                           â”‚
â”‚  Network Request to Supabase:                            â”‚
â”‚  POST /rest/v1/assignments                              â”‚
â”‚  Authorization: Bearer <token>                          â”‚
â”‚  Body: [                                                â”‚
â”‚    {company_id, user_id, role, created_at},             â”‚
â”‚    ...                                                  â”‚
â”‚  ]                                                       â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€ Supabase Database â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                          â”‚
â”‚  RLS Policy Check:                                       â”‚
â”‚  - User authenticated? âœ“                                â”‚
â”‚  - Permission to insert? âœ“                              â”‚
â”‚  - Valid table? âœ“                                       â”‚
â”‚                                                          â”‚
â”‚  INSERT INTO assignments (id, company_id, user_id, ...) â”‚
â”‚  VALUES                                                 â”‚
â”‚    (uuid1, comp1, user1, 'CONTACT', now()),            â”‚
â”‚    (uuid2, comp2, user2, 'CONTACT', now()),            â”‚
â”‚    (uuid3, comp3, user3, 'CONTACT', now()),            â”‚
â”‚    ...                                                  â”‚
â”‚                                                          â”‚
â”‚  Result: {                                              â”‚
â”‚    status: 201                                          â”‚
â”‚    data: [inserted objects]                             â”‚
â”‚    error: null                                          â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€ BulkRandomAssignment Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  7. Handle response                                         â”‚
â”‚     if (error) throw error                                 â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚  8. Success: Show toast                                    â”‚
â”‚     toast({                                                â”‚
â”‚       title: "SuccÃ¨s",                                     â”‚
â”‚       description: "150 affectations crÃ©Ã©es..."            â”‚
â”‚     })                                                      â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚  9. Refresh data                                           â”‚
â”‚     fetchData() â† Reload from server                       â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚  10. Reset form                                            â”‚
â”‚      setSelectedUsers(new Set())                           â”‚
â”‚      setCompaniesPerUser('10')                             â”‚
â”‚      â”‚                                                        â”‚
â”‚      â–¼                                                        â”‚
â”‚  11. setIsProcessing(false) â† Re-enable UI                 â”‚
â”‚      â”‚                                                        â”‚
â”‚      â–¼                                                        â”‚
â”‚  Success! Ready for next operation                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Files & Modules Structure

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ assignments/
â”‚   â”‚   â”œâ”€â”€ AssignmentManager.tsx (MODIFIED)
â”‚   â”‚   â”‚   â”œâ”€â”€ Imports: BulkRandomAssignment
â”‚   â”‚   â”‚   â”œâ”€â”€ Render: <BulkRandomAssignment /> (conditional)
â”‚   â”‚   â”‚   â””â”€â”€ State: users, assignments, companies, etc.
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ BulkRandomAssignment.tsx (ğŸ†• NEW)
â”‚   â”‚       â”œâ”€â”€ Exports: BulkRandomAssignment component
â”‚   â”‚       â”œâ”€â”€ State: users, unassignedCompanies, selectedUsers, etc.
â”‚   â”‚       â”œâ”€â”€ Methods: fetchData, performBulkAssignment, etc.
â”‚   â”‚       â””â”€â”€ UI: Statistics, form, confirmation dialog
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ button.tsx (used)
â”‚   â”‚   â”œâ”€â”€ card.tsx (used)
â”‚   â”‚   â”œâ”€â”€ checkbox.tsx (used)
â”‚   â”‚   â”œâ”€â”€ alert-dialog.tsx (used)
â”‚   â”‚   â”œâ”€â”€ input.tsx (used)
â”‚   â”‚   â”œâ”€â”€ badge.tsx (used)
â”‚   â”‚   â””â”€â”€ ...other components
â”‚   â”‚
â”‚   â””â”€â”€ layout/
â”‚       â””â”€â”€ Sidebar.tsx
â”‚           â””â”€â”€ Links to Affectations page
â”‚
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.tsx
â”‚       â””â”€â”€ Provides: user, profile, currentUserRole
â”‚
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ use-toast.ts
â”‚       â””â”€â”€ Provides: toast() function
â”‚
â””â”€â”€ integrations/
    â””â”€â”€ supabase/
        â”œâ”€â”€ client.ts (used)
        â”‚   â””â”€â”€ supabase client instance
        â””â”€â”€ types.ts (used)
            â””â”€â”€ Database types
```

---

**Created**: October 2025  
**Feature Status**: âœ… Complete and Ready
